# ============================================
# Serviço Systemd para ClawdBot
# Copie para: /etc/systemd/system/clawdbot.service
# ============================================

[Unit]
Description=ClawdBot AI Agent - Gateway
Documentation=https://github.com/clawdbot/clawdbot

# Dependências
After=network.target network-online.target
Wants=network-online.target

# Iniciar após o Ollama
After=ollama.service
Wants=ollama.service

[Service]
# Tipo de serviço
Type=simple

# Usuário (substitua pelo seu usuário)
User=orangepi
Group=orangepi

# Diretório de trabalho
WorkingDirectory=/home/orangepi

# Variáveis de ambiente
Environment="HOME=/home/orangepi"
Environment="NODE_OPTIONS=--max-old-space-size=4096"
Environment="PATH=/home/orangepi/.nvm/versions/node/v22.0.0/bin:/usr/local/bin:/usr/bin:/bin"

# Comando de execução
ExecStart=/home/orangepi/.nvm/versions/node/v22.0.0/bin/clawdbot gateway --port 18789

# Reiniciar automaticamente em caso de falha
Restart=always
RestartSec=10

# Timeout para inicialização
TimeoutStartSec=60

# Logs
StandardOutput=journal
StandardError=journal
SyslogIdentifier=clawdbot

# Limites de recursos (otimizado para Orange Pi 32GB)
LimitNOFILE=65535
MemoryMax=8G
MemoryHigh=6G
CPUQuota=80%

# Prioridade de agendamento
Nice=0
IOSchedulingClass=best-effort
IOSchedulingPriority=4

# Segurança (permitir acesso ao sistema para funcionar)
NoNewPrivileges=false
ProtectSystem=false
ProtectHome=false

# Capabilidades
CapabilityBoundingSet=CAP_NET_BIND_SERVICE CAP_SYS_PTRACE
AmbientCapabilities=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target

# ============================================
# Comandos úteis:
# 
# Copiar arquivo:
#   sudo cp services/clawdbot.service /etc/systemd/system/
#
# Recarregar systemd:
#   sudo systemctl daemon-reload
#
# Habilitar no boot:
#   sudo systemctl enable clawdbot
#
# Iniciar:
#   sudo systemctl start clawdbot
#
# Ver status:
#   sudo systemctl status clawdbot
#
# Ver logs:
#   journalctl -u clawdbot -f
# ============================================
